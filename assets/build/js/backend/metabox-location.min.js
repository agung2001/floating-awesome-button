window.FAB_METABOX_LOCATION={...window.FAB_METABOX_LOCATION,defaultOptions:{...window.FAB_METABOX_LOCATION.defaultOptions,select2:{placeholder:"--choose--"},type:[{id:"post_type",text:"Post Type"}],post_types:[],convert_post_types_to_select2_option:()=>{let e=window.FAB_METABOX_LOCATION.post_types;e=(e=Object.keys(e).sort().map(function(t,a){return{id:t,text:e[t].label}})).filter(function(e,t){return!window.FAB_METABOX_LOCATION.excludes_post_types.includes(e.id)}),window.FAB_METABOX_LOCATION.defaultOptions.post_types=e,window.FAB_METABOX_LOCATION.defaultOptions.type=[...window.FAB_METABOX_LOCATION.defaultOptions.type,{id:"single",text:"Single Page",children:e}]}},init:()=>{if(window.FAB_METABOX_LOCATION.defaultOptions.convert_post_types_to_select2_option(),window.FAB_METABOX_LOCATION.add_rule_item(),window.FAB_METABOX_LOCATION.data.locations.length){let e=window.FAB_METABOX_LOCATION.data.locations;e.map(function(e,t){t&&window.FAB_METABOX_LOCATION.add_rule_item()}),jQuery("#rules-locations .rule-item").each(function(t){let a={placeholder:window.FAB_METABOX_LOCATION.defaultOptions.select2.placeholder},o=jQuery('.select2[name="fab_location_type[]',this);o.val(e[t].type),o.trigger("change");let l=jQuery('.select2[name="fab_location_operator[]',this);l.val(e[t].operator),l.trigger("change"),a.selectedValue=e[t].value;let n=jQuery('.select2[name="fab_location_value[]',this);a=window.FAB_METABOX_LOCATION.getComparatorOption(e[t].type,a),n.select2("destroy"),void 0===a.data&&(n.html(`<option value="${e[t].value.ID}" selected="selected">${e[t].value.post_title}</option>`),a.selectedValue=e[t].value.ID),n.select2(a),n.val(a.selectedValue),n.trigger("change")})}jQuery("#post").on("submit",function(){let e=window.FAB_METABOX_LOCATION.check_invalid_rules();if(1==jQuery("#rules-locations .rule-item").length&&e){let e=jQuery("#rules-locations .rule-item").last();return jQuery('.select2[name="fab_location_type[]',e).val(""),jQuery('.select2[name="fab_location_type[]',e).trigger("change"),jQuery('.select2[name="fab_location_operator[]',e).val(""),jQuery('.select2[name="fab_location_operator[]',e).trigger("change"),jQuery('.select2[name="fab_location_value[]',e).val(""),jQuery('.select2[name="fab_location_value[]',e).trigger("change"),!0}return e&&jQuery.dialog({icon:"fas fa-times",closeIcon:!0,animation:"scale",columnClass:"j-small",title:"Error",content:"Please check input, there are invalid location rules!"}),!e})},check_invalid_rules:()=>{let e=!1;return jQuery("#rules-locations .rule-item").each(function(){let t;return(t=jQuery('.select2[name="fab_location_type[]',this)).val()&&(t=jQuery('.select2[name="fab_location_operator[]',this)).val()&&(t=jQuery('.select2[name="fab_location_value[]',this)).val()?void 0:(e=!0,!1)}),e},add_rule_item:()=>{let e=jQuery(".fab-container.metabox-location #element-rule-item").html();jQuery(".fab-container.metabox-location #rules-locations").append(e);let t=jQuery("#rules-locations .rule-item").last();window.FAB_METABOX_LOCATION.select2LocationRender(t)},remove_rule_item:e=>{let t=jQuery(".fab-container.metabox-location #rules-locations .rule-item").length;jQuery(e).closest(".rule-item").remove(),1==t&&window.FAB_METABOX_LOCATION.add_rule_item()},select2LocationRender:e=>{let t={placeholder:window.FAB_METABOX_LOCATION.defaultOptions.select2.placeholder},a=jQuery('.select2[name="fab_location_type[]',e);window.FAB_METABOX_LOCATION.reloadSelect2(a,{...t,data:window.FAB_METABOX_LOCATION.defaultOptions.type});let o=jQuery('.select2[name="fab_location_operator[]',e);window.FAB_METABOX_LOCATION.reloadSelect2(o,{...t,data:window.FAB_METABOX_LOCATION.defaultOptions.operator});let l=jQuery('.select2[name="fab_location_value[]',e);t=window.FAB_METABOX_LOCATION.getComparatorOption(a.val(),t),window.FAB_METABOX_LOCATION.reloadSelect2(l,t),a.on("change",function(e){window.FAB_METABOX_LOCATION.triggerChangeType(jQuery(a))}),a.on("select2:select",function(e){window.FAB_METABOX_LOCATION.triggerChangeType(jQuery(a))})},reloadSelect2:(e,t)=>{t.selectedValue=e.val(),e.data("select2")&&(e.select2("destroy"),e.html("")),e.select2(t),e.val(t.selectedValue),e.trigger("change")},triggerChangeType:e=>{let t={placeholder:window.FAB_METABOX_LOCATION.defaultOptions.select2.placeholder};t=window.FAB_METABOX_LOCATION.getComparatorOption(e.val(),t),e.closest(".rule-item").find('.select2[name="fab_location_value[]"]').select2(t)},getComparatorOption:(e,t)=>("post_type"==e?t.data=window.FAB_METABOX_LOCATION.defaultOptions.post_types:t.ajax={delay:500,dataType:"json",url:window.FAB_METABOX_LOCATION.getComparatorOptionAjax.url,data:window.FAB_METABOX_LOCATION.getComparatorOptionAjax.data,processResults:window.FAB_METABOX_LOCATION.getComparatorOptionAjax.processResults},t),getComparatorOptionAjax:{url(e){let t=jQuery(this).closest(".rule-item").find('.select2[name="fab_location_type[]"]').val();if(!t)return!1;let a=window.FAB_METABOX_LOCATION.post_types[t].rest_base;return a=a||t,a+=window.FAB_PLUGIN.isNumeric(e.term)?`/${e.term}`:"",`${window.FAB_METABOX_LOCATION.rest_url}wp/v2/${a}`},data(e){let t={_fields:"id,title"};return window.FAB_PLUGIN.isNumeric(e.term)||(t={...t,filter:{post_status:"publish,private"},page:e.page||1,search:e.term,orderby:"title",order:"asc"}),window.FAB_METABOX_LOCATION.ajax_params=t,t},processResults(e){let t={more:!1};return window.FAB_METABOX_LOCATION.ajax_params.page<this._request.getResponseHeader("X-WP-TotalPages")&&(t.more=!0),Array.isArray(e)||(e=[e]),{results:e=e.map(function(e,t){return{id:e.id,text:e.title.rendered.replace(/[^\w\s]/gi,"")}}),pagination:t}}}};