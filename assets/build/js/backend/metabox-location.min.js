var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,a=1,o=arguments.length;a<o;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(e,t,a){if(a||2===arguments.length)for(var o,n=0,r=t.length;n<r;n++)!o&&n in t||(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))};window.FAB_METABOX_LOCATION=__assign(__assign({},window.FAB_METABOX_LOCATION),{defaultOptions:__assign(__assign({},window.FAB_METABOX_LOCATION.defaultOptions),{select2:{placeholder:"--choose--"},type:[],post_types:[],convert_post_types_to_select2_option:function(){var e=window.FAB_METABOX_LOCATION.post_types;e=(e=Object.keys(e).sort().map(function(t,a){return{id:t,text:e[t].label}})).filter(function(e,t){return!window.FAB_METABOX_LOCATION.excludes_post_types.includes(e.id)}),window.FAB_METABOX_LOCATION.defaultOptions.post_types=e,window.FAB_METABOX_LOCATION.defaultOptions.type=__spreadArray(__spreadArray([{text:"Post",children:__spreadArray([{id:"post_type",text:"Post Type"}],e.map(function(e,t){var a=e.text.substr(e.text.length-1);return a="s"===a?e.text.substring(0,e.text.length-1):e.text,{id:"single_".concat(e.id),text:"Single ".concat(a)}}),!0)}],window.FAB_METABOX_LOCATION.defaultOptions.type,!0),[{text:"User",children:[{id:"user_session",text:"Session"}]}],!1)}}),init:function(){if(window.FAB_METABOX_LOCATION.defaultOptions.convert_post_types_to_select2_option(),window.FAB_METABOX_LOCATION.add_rule_item(),window.FAB_METABOX_LOCATION.data.locations.length){var e=window.FAB_METABOX_LOCATION.data.locations;e.map(function(e,t){t&&window.FAB_METABOX_LOCATION.add_rule_item()}),jQuery("#rules-locations .rule-item").each(function(t){var a={placeholder:window.FAB_METABOX_LOCATION.defaultOptions.select2.placeholder},o=jQuery('.select2[name="fab_location_type[]',this);o.val(e[t].type),o.trigger("change");var n=jQuery('.select2[name="fab_location_operator[]',this);n.val(e[t].operator),n.trigger("change"),a.selectedValue=e[t].value;var r=jQuery('.select2[name="fab_location_value[]',this);a=window.FAB_METABOX_LOCATION.getComparatorOption(e[t].type,a),r.select2("destroy"),void 0===a.data&&(r.html('<option value="'.concat(e[t].value.ID,'" selected="selected">').concat(e[t].value.post_title,"</option>")),a.selectedValue=e[t].value.ID),r.select2(a),r.val(a.selectedValue),r.trigger("change");var i=jQuery('.select2[name="fab_location_logic[]',this);i.val(e[t].logic),i.trigger("change")})}jQuery("#post").on("submit",function(){var e=window.FAB_METABOX_LOCATION.check_invalid_rules();if(1==jQuery("#rules-locations .rule-item").length&&e){var t=jQuery("#rules-locations .rule-item").last();return jQuery('.select2[name="fab_location_type[]',t).val(""),jQuery('.select2[name="fab_location_type[]',t).trigger("change"),jQuery('.select2[name="fab_location_operator[]',t).val(""),jQuery('.select2[name="fab_location_operator[]',t).trigger("change"),jQuery('.select2[name="fab_location_value[]',t).val(""),jQuery('.select2[name="fab_location_value[]',t).trigger("change"),jQuery('.select2[name="fab_location_logic[]',t).val(""),jQuery('.select2[name="fab_location_logic[]',t).trigger("change"),!0}return e&&jQuery.dialog({icon:"fas fa-times",closeIcon:!0,animation:"scale",columnClass:"j-small",title:"Error",content:"Please check input, there are invalid location rules!"}),!e})},check_invalid_rules:function(){var e=!1;return jQuery("#rules-locations .rule-item").each(function(){return jQuery('.select2[name="fab_location_type[]',this).val()&&jQuery('.select2[name="fab_location_operator[]',this).val()&&jQuery('.select2[name="fab_location_value[]',this).val()&&jQuery('.select2[name="fab_location_logic[]',this).val()?void 0:(e=!0,!1)}),e},add_rule_item:function(){var e=jQuery(".fab-container.metabox-location #element-rule-item").html();jQuery(".fab-container.metabox-location #rules-locations").append(e);var t=jQuery("#rules-locations .rule-item").last();window.FAB_METABOX_LOCATION.select2LocationRender(t)},remove_rule_item:function(e){var t=jQuery(".fab-container.metabox-location #rules-locations .rule-item").length;jQuery(e).closest(".rule-item").remove(),1==t&&window.FAB_METABOX_LOCATION.add_rule_item()},select2LocationRender:function(e){var t={placeholder:window.FAB_METABOX_LOCATION.defaultOptions.select2.placeholder},a=jQuery('.select2[name="fab_location_type[]',e);window.FAB_METABOX_LOCATION.reloadSelect2(a,__assign(__assign({},t),{data:window.FAB_METABOX_LOCATION.defaultOptions.type}));var o=jQuery('.select2[name="fab_location_operator[]',e);window.FAB_METABOX_LOCATION.reloadSelect2(o,__assign(__assign({},t),{data:window.FAB_METABOX_LOCATION.defaultOptions.operator}));var n=jQuery('.select2[name="fab_location_logic[]',e);window.FAB_METABOX_LOCATION.reloadSelect2(n,__assign(__assign({},t),{data:window.FAB_METABOX_LOCATION.defaultOptions.logic}));var r=jQuery('.select2[name="fab_location_value[]',e);t=window.FAB_METABOX_LOCATION.getComparatorOption(a.val(),t),window.FAB_METABOX_LOCATION.reloadSelect2(r,t),a.on("change",function(e){window.FAB_METABOX_LOCATION.triggerChangeType(jQuery(a))}),a.on("select2:select",function(e){window.FAB_METABOX_LOCATION.triggerChangeType(jQuery(a))})},reloadSelect2:function(e,t){t.selectedValue=e.val(),e.data("select2")&&(e.select2("destroy"),e.html("")),e.select2(t),e.val(t.selectedValue),e.trigger("change")},triggerChangeType:function(e){var t={placeholder:window.FAB_METABOX_LOCATION.defaultOptions.select2.placeholder};t=window.FAB_METABOX_LOCATION.getComparatorOption(e.val(),t),e.closest(".rule-item").find('.select2[name="fab_location_value[]"]').select2(t)},getComparatorOption:function(e,t){return void 0!==e&&e&&("post_type"===e?t.data=window.FAB_METABOX_LOCATION.defaultOptions.post_types:e.includes("single_")?t.ajax={delay:500,dataType:"json",url:window.FAB_METABOX_LOCATION.getComparatorOptionSingleAjax.url,data:window.FAB_METABOX_LOCATION.getComparatorOptionSingleAjax.data,processResults:window.FAB_METABOX_LOCATION.getComparatorOptionSingleAjax.processResults}:"user_session"===e&&(t.data=[{id:"user_session_logged_in",text:"Logged In"}])),t},getComparatorOptionSingleAjax:{url:function(e){var t=jQuery(this).closest(".rule-item").find('.select2[name="fab_location_type[]"]').val();if(!t)return!1;t=t.replace("single_","");var a=window.FAB_METABOX_LOCATION.post_types[t].rest_base;return a=a||t,a+=window.FAB_PLUGIN.isNumeric(e.term)?"/".concat(e.term):"","".concat(window.FAB_METABOX_LOCATION.rest_url,"wp/v2/").concat(a)},data:function(e){var t={_fields:"id,title"};return window.FAB_PLUGIN.isNumeric(e.term)||(t=__assign(__assign({},t),{filter:{post_status:"publish,private"},page:e.page||1,search:e.term,orderby:"title",order:"asc"})),window.FAB_METABOX_LOCATION.ajax_params=t,t},processResults:function(e){var t={more:!1};return window.FAB_METABOX_LOCATION.ajax_params.page<this._request.getResponseHeader("X-WP-TotalPages")&&(t.more=!0),Array.isArray(e)||(e=[e]),{results:e=e.map(function(e,t){return{id:e.id,text:e.title.rendered.replace(/[^\w\s]/gi,"")}}),pagination:t}}}});